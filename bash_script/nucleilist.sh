#!/bin/bash

# Check if the correct number of arguments is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <ip_list_file>"
    exit 1
fi

IP_LIST_FILE="$1"

# Check if the IP list file exists
if [ ! -f "$IP_LIST_FILE" ]; then
    echo "Error: IP list file not found: $IP_LIST_FILE"
    exit 1
fi

OUTPUT_DIR="./nuclei_output"

# Run nuclei with JSON output
nuclei -l "$IP_LIST_FILE" -je "$OUTPUT_DIR/nuclei_output.json"

# Check if nuclei command executed successfully
if [ $? -ne 0 ]; then
    echo "Error: Nuclei scan failed."
    exit 1
fi

# Extract high and medium severity findings
HIGH_FINDINGS=$(cat "$OUTPUT_DIR/nuclei_output.json" | jq -r '.[].severity' | grep -c "high")
MEDIUM_FINDINGS=$(cat "$OUTPUT_DIR/nuclei_output.json" | jq -r '.[].severity' | grep -c "medium")

# Display findings summary
echo "Nuclei scan completed."
echo "High Severity Findings: $HIGH_FINDINGS"
echo "Medium Severity Findings: $MEDIUM_FINDINGS"

# Alert if medium or high vulnerabilities found
if [ "$HIGH_FINDINGS" -gt 0 ]; then
    echo "ALERT: High severity vulnerabilities found!"
fi

if [ "$MEDIUM_FINDINGS" -gt 0 ]; then
    echo "ALERT: Medium severity vulnerabilities found!"
fi
