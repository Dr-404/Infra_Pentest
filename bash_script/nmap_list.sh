#!/bin/bash

# Check if the correct number of arguments is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <ip_list_file>"
    exit 1
fi

IP_LIST_FILE="$1"

# Check if the IP list file exists
if [ ! -f "$IP_LIST_FILE" ]; then
    echo "Error: IP list file not found: $IP_LIST_FILE"
    exit 1
fi

OUTPUT_DIR="./output"

# Check if the output folder exists
if [ ! -d "$OUTPUT_DIR" ]; then
    # If not, create the output folder
    mkdir "$OUTPUT_DIR"
    echo "Created output folder: $OUTPUT_DIR"
else
    echo "Output folder $OUTPUT_DIR already exists."
fi

# Read IPs from the file and run nmap scan for each IP
while IFS= read -r IP; do
    echo "Scanning IP: $IP"
    sudo nmap -vv -T4 -Pn -n --host-timeout=4h --defeat-rst-ratelimit --open -sCV -O -A -p- "$IP" -oA "$OUTPUT_DIR/$IP"
done < "$IP_LIST_FILE"
